.. _index:

.. toctree::
   :maxdepth: 1

前言
====

大概一年以前，几个朋友和同事偶尔跟我聊到股票的数据问题，因为大多是搞开发的，所以希望能从技术的角度获取一些数据并加以分析，看是否能通过数据的量化分析发现一些影响股价涨跌的蛛丝马迹。从那以后，我收集整理了一些数据接口，正好那段时间因个人兴趣正在学习数据分析，利用python
pandas包做了一些实践，由于个人比较喜欢pandas这个工具，通过DataFrame结构化的数据配合Python语言本身的编程功能很容易实现处理和分析，所以近来把之前收集来的股票等财经数据接口都封装成函数实现了便捷抓取，返回的数据基本都是DataFrame格式，非常便于用pandas/Numpy/Matplotlib进行数据分析和可视化。

TuShare不是一个有多么高大上的东西，也没有多少技术含量，实现相对简单，当前版本只提供经过了初步处理的数据，但调用和使用非常非常简单，目的就是为做金融分析的人提供便捷、干净的数据，仅此而已。所有的数据都来自各大门户网站，尤其是sina财经，所以特别感谢新浪。如果在使用过程碰到数据源地址发生变更或者数据结构变化造成错误，请自行查找和修改，或者通过\ **Email:jimmysoa@sina.cn
QQ:52799046**
联系我，如果有什么好的建议和意见，也请及时联系我，在此谢过。

对于后期的愿景，其实TuShare也是向往着走向“高大上”的^\_^，比如把期货等金融数据也纳入进来，另外，最关键是要做一些\ **数据模型**
，为做量化分析的朋友，为怀揣着金融梦想立志成为Quant的朋友提供一些帮助。所以，欢迎有着同样兴趣的朋友加入进来，一起做点“让数据产生价值”的事，一起让自己的想法变成有着实际载体的具体实现。

使用对象
--------

-  对财经数据感兴趣的人
-  对金融市场进行大数据分析的人
-  正在学习利用python进行数据分析的人

使用前提
--------

-  安装python2.7
-  安装pandas

下载安装
--------

-  方式1：pip install tushare
-  方式2：\ `下载到本地 <https://github.com/waditu/tushare>`__ python
   setup.py install

版本升级
--------

-  pip install tushare --upgrade


交易数据获取
============

*交易类数据*\ 提供股票的交易行情数据，通过简单的接口调用可获取相应的DataFrame格式数据，主要包括以下类别：

-  历史行情数据
-  实时行情数据
-  历史分笔数据
-  实时分笔数据

历史行情
--------

获取个股历史交易数据（包括均线数据）

::

    import tushare.stock.trading as td

    td.get_hist_data('600848') #一次性获取全部数据

结果显示：

    日期 ，开盘价， 最高价， 收盘价， 最低价， 成交量， 价格变动
    ，涨跌幅，5日均价，10日均价，20日均价，5日均量，10日均量，20日均量，换手率

::

                 open    high   close     low     amount    p_change  ma5 \
    date                                                                     
    2012-01-11   6.880   7.380   7.060   6.880   14129.96     2.62   7.060   
    2012-01-12   7.050   7.100   6.980   6.900    7895.19    -1.13   7.020   
    2012-01-13   6.950   7.000   6.700   6.690    6611.87    -4.01   6.913   
    2012-01-16   6.680   6.750   6.510   6.480    2941.63    -2.84   6.813   
    2012-01-17   6.660   6.880   6.860   6.460    8642.57     5.38   6.822   
    2012-01-18   7.000   7.300   6.890   6.880   13075.40     0.44   6.788   
    2012-01-19   6.690   6.950   6.890   6.680    6117.32     0.00   6.770   
    2012-01-20   6.870   7.080   7.010   6.870    6813.09     1.74   6.832 

                 ma10    ma20      v_ma5     v_ma10     v_ma20     turnover  
    date                                                                  
    2012-01-11   7.060   7.060   14129.96   14129.96   14129.96     0.48  
    2012-01-12   7.020   7.020   11012.58   11012.58   11012.58     0.27  
    2012-01-13   6.913   6.913    9545.67    9545.67    9545.67     0.23  
    2012-01-16   6.813   6.813    7894.66    7894.66    7894.66     0.10  
    2012-01-17   6.822   6.822    8044.24    8044.24    8044.24     0.30  
    2012-01-18   6.833   6.833    7833.33    8882.77    8882.77     0.45  
    2012-01-19   6.841   6.841    7477.76    8487.71    8487.71     0.21  
    2012-01-20   6.863   6.863    7518.00    8278.38    8278.38     0.23  

设定历史数据的时间：

::

    td.get_hist_data('600848','2015-01-05','2015-01-09')

                open    high   close     low    amount p_change     ma5    ma10 \  
    date                                                                            
    2015-01-05  11.160  11.390  11.260  10.890  46383.57     1.26  11.156  11.212   
    2015-01-06  11.130  11.660  11.610  11.030  59199.93     3.11  11.182  11.155   
    2015-01-07  11.580  11.990  11.920  11.480  86681.38     2.67  11.366  11.251   
    2015-01-08  11.700  11.920  11.670  11.640  56845.71    -2.10  11.516  11.349   
    2015-01-09  11.680  11.710  11.230  11.190  44851.56    -3.77  11.538  11.363   
                ma20     v_ma5    v_ma10     v_ma20      turnover  
    date                                                        
    2015-01-05  11.198  58648.75  68429.87   97141.81     1.59  
    2015-01-06  11.382  54854.38  63401.05   98686.98     2.03  
    2015-01-07  11.543  55049.74  61628.07  103010.58     2.97  
    2015-01-08  11.647  57268.99  61376.00  105823.50     1.95  
    2015-01-09  11.682  58792.43  60665.93  107924.27     1.54  

实时行情
--------

一次性获取当前交易所有股票的行情数据（如果是节假日，即为上一交易日，结果显示速度取决于网速）

::

    import tushare.stock.trading as td

    td.get_today_all()

结果显示：

    代码，名称，涨跌幅，现价，开盘价，最高价，最低价，最日收盘价，成交量，换手率

::

          code    name     changepercent  trade   open   high    low  settlement \  
    0     002738  中矿资源         10.023  19.32  19.32  19.32  19.32       17.56   
    1     300410  正业科技         10.022  25.03  25.03  25.03  25.03       22.75   
    2     002736  国信证券         10.013  16.37  16.37  16.37  16.37       14.88   
    3     300412  迦南科技         10.010  31.54  31.54  31.54  31.54       28.67   
    4     300411  金盾股份         10.007  29.68  29.68  29.68  29.68       26.98   
    5     603636  南威软件         10.006  38.15  38.15  38.15  38.15       34.68   
    6     002664  信质电机         10.004  30.68  29.00  30.68  28.30       27.89   
    7     300367  东方网力         10.004  86.76  78.00  86.76  77.87       78.87   
    8     601299  中国北车         10.000  11.44  11.44  11.44  11.29       10.40   
    9     601880   大连港         10.000   5.72   5.34   5.72   5.22        5.20   
    10    000856  冀东装备         10.000   8.91   8.18   8.91   8.18        8.10  
            volume       turnoverratio  
    0        375100        1.25033  
    1         85800        0.57200  
    2       1058925        0.08824  
    3         69400        0.51791  
    4        252220        1.26110  
    5       1374630        5.49852  
    6       6448748        9.32700  
    7       2025030        6.88669  
    8     433453523        4.28056  
    9     323469835        9.61735  
    10     25768152       19.51090  

历史分笔
--------

::

    import tushare.stock.trading as td

    df = td.get_tick_data('600848','2014-01-09')
    df.head(10)

结果显示：

    成交时间、成交价格、价格变动，成交手、成交金额(元)，买卖类型

::

         time       price change  volume  amount  type
    0    15:00:00   6.05     --       8    4840   卖盘
    1    14:59:55   6.05     --      50   30250   卖盘
    2    14:59:35   6.05     --      20   12100   卖盘
    3    14:59:30   6.05  -0.01     165   99825   卖盘
    4    14:59:20   6.06   0.01       4    2424   买盘
    5    14:59:05   6.05  -0.01       2    1210   卖盘
    6    14:58:55   6.06     --       4    2424   买盘
    7    14:58:45   6.06     --       2    1212   买盘
    8    14:58:35   6.06   0.01       2    1212   买盘
    9    14:58:25   6.05  -0.01      20   12100   卖盘
    10   14:58:05   6.06     --       5    3030   买盘

实时分笔
--------
获取实时分笔数据，可以实时取得股票当前报价和成交信息，其中一种场景是，写一个python定时程序来调用本接口（可两三秒执行一次，性能与行情软件基本一致），然后通过DataFrame的矩阵计算实现交易监控，可实时监测交易量和价格的变化。


::

    import tushare.stock.trading as td

    df = td.get_realtime_quotes('000581') #Single stock symbol
    df[['code','name','price','bid','ask','volume','amount','time']]

结果显示：

::

       code    name     price  bid    ask    volume   amount        time
    0  000581  威孚高科  31.15  31.14  31.15  8183020  253494991.16  11:30:36

结果属性：

::

    0：name，股票名字
    1：open，今日开盘价
    2：pre_close，昨日收盘价
    3：price，当前价格
    4：high，今日最高价
    5：low，今日最低价
    6：bid，竞买价，即“买一”报价
    7：ask，竞卖价，即“卖一”报价
    8：volumn，成交量 maybe you need do volumn/100
    9：amount，成交金额（元 CNY）
    10：b1_v，委买一（笔数 bid volume）
    11：b1_p，委买一（价格 bid price）
    12：b2_v，“买二”
    13：b2_p，“买二”
    14：b3_v，“买三”
    15：b3_p，“买三”
    16：b4_v，“买四”
    17：b4_p，“买四”
    18：b5_v，“买五”
    19：b5_p，“买五”
    20：a1_v，委卖一（笔数 ask volume）
    21：a1_p，委卖一（价格 ask price）
    ...
    30：date，日期；
    31：time，时间；
      

请求多个股票方法（一次最好不要超过30个）：

::

    #symbols from a list
    td.get_realtime_quotes(['600848','000980','000981']) 
    #from a Series
    td.get_realtime_quotes(df['code'].tail(10))


基本面数据获取
==============

*基本面类数据*\ 提供所有股票的基本面情况，包括股本情况、业绩预告和业绩预告等。主要包括以下类别：

-  沪深股票列表
-  业绩预告
-  业绩报告（主表）
-  盈利能力数据
-  营运能力数据
-  成长能力数据
-  偿债能力数据
-  现金流量数据

本模块数据全部来自sina财经，由于财务数据项目比较多，所以拆分成了几个表，使用时可以通过股票代码合并在一起，也可以独立使用。数据在获取时，需要一页一页的抓取，所以需要一点等待时间，最后会合并成一个大表。

沪深股票列表
------------

获取沪深上市公司基本情况。属性包括：

::

       code,代码
       name,名称
       industry,所属行业
       area,地区
       pe,市盈率
       outstanding,流通股本
       totals,总股本(万)
       totalAssets,总资产(万)
       liquidAssets,流动资产
       fixedAssets,固定资产
       reserved,公积金
       reservedPerShare,每股公积金
       eps,每股收益
       bvps,每股净资
       pb,市净率
       timeToMarket,上市日期

由于目前暂时没有找到能便捷获取股本等信息的web接口，现在是以直接读取文件（data/all.csv）的方式实现，所以需要定期更新。或者按以上columns自行从行情软件导出数据。

::

    import tushare.stock.fundamental as fd

    fd.get_stock_basics()

结果显示：

::

            name        industry area      pe    totals  outstanding  totalAssets  \
    code                                                                     
    002143  印纪传媒     影视音像   四川    0.00   8997.95    110614.63    188528.16   
    600487  亨通光电     通信设备   江苏   25.96  31062.38     41375.64   1223671.25   
    300304  云意电气     汽车配件   江苏   40.08   6400.00     20000.00    120278.88   
    000626  如意集团     商贸代理   江苏   24.04  20229.75     20250.00    988070.88   
    300349  金卡股份     电器仪表   浙江   36.17   4500.00     18000.00    113211.00   
    300204   舒泰神     生物制药   北京   41.64  23575.42     24012.00    172687.81   
    300096   易联众     软件服务   福建  165.81  29900.63     43000.00     80462.52   
    300376   易事特     电气设备   广东   40.70   4478.00     17890.00    207726.20   
    002103  广博股份     文教休闲   浙江  214.46  17095.44     21843.09    114295.57   
    002735  王子新材       塑料   深圳   80.95   2000.00      8000.00     41200.78 

如果是使用自己的数据，只要表头与默认文件格式一致，可设定文件路径的方式读入，例如：fd.get\_stock\_basics('c:\\all\_stocks.csv')

业绩预告
--------

按年度、季度获取业绩预告数据，接口提供从1998年以后每年的业绩预告数据，需指定年度、季度两个参数。数据在获取的过程中，会打印进度信息(下同)。
结果返回的数据属性说明如下：

::

    code,代码
    name,名称
    type,业绩变动类型【预增、预亏等】
    report_date,发布日期
    pre_eps,上年同期每股收益
    range,业绩变动范围

调用方法：

::

    #获取2014年中报的业绩预告数据
    fd.get_forecast_data(2014,2)

结果返回：

::

          code      name     type report_date  pre_eps             range
    0     000710   天兴仪表   预亏  2014-08-27  -0.0178                --
    1     600710   常林股份   减亏  2014-08-23    -0.12                --
    2     002071   长城影视   预升  2014-08-21   0.0032              6.72
    3     000555   神州信息   预升  2014-08-21  -0.0494              36.7
    4     600007   中国国贸   预升  2014-08-20     0.23             23.21
    5     002125   湘潭电化   预亏  2014-08-19  -0.1721                --
    6     300153   科泰电源   预升  2014-08-18     0.07             20.02
    7     601668   中国建筑   --   2014-08-15     0.29               30%
    8     600754   锦江股份   预升  2014-08-15   0.2786             10.83
    9     002491   通鼎互联   预升  2014-08-14   0.3817              2.22
    10    601177   杭齿前进   预升  2014-08-12   0.0373             37.43

业绩报告（主表）
----------------

按年度、季度获取业绩报表数据。数据获取需要一定的时间，网速取决于您的网速，请耐心等待。结果返回的数据属性说明如下：

::

    code,代码
    name,名称
    eps,每股收益
    eps_yoy,每股收益同比(%)
    bvps,每股净资产
    roe,净资产收益率(%)
    epcf,每股现金流量(元)
    net_profits,净利润(万元)
    profits_yoy,净利润同比(%)
    distrib,分配方案
    report_date,发布日期

调用方法：

::

    #获取2014年第3季度的业绩报表数据
    fd.get_report_data(2014,3)

结果返回：

::

            code   name      eps   eps_yoy  bvps     roe   epcf net_profits  \
    0     601069   西部黄金     --       --     0       0      0     4801.01   
    1     300419   浩丰科技   1.15       --  7.25    16.9  -0.67      3534.9   
    2     603678   火炬电子   0.84     37.7     0   19.04      0    10450.38   
    3     300413    快乐购   0.33    -8.33     0   12.62      0    11035.65   
    4     603601   再升科技   0.62    43.75     0   17.73      0     3156.93   
    5     300364   中文在线     --       --     0       0      0     1037.41   
    6     300417   南华仪器   0.61    15.09     0   11.03      0     1859.62   
    7     603600   永艺股份   0.58       --  3.31   18.14   0.35     4350.88   
    8     002740    爱迪尔     --       --     0       0      0     6174.52   
    9     300418   昆仑万维    1.2   103.39     0   25.74      0     25210.2   
    10    002739   万达院线     --       --     0       0      0    67606.93   

盈利能力
--------

按年度、季度获取盈利能力数据，结果返回的数据属性说明如下：

::

    code,代码
    name,名称
    roe,净资产收益率(%)
    net_profit_ratio,净利率(%)
    gross_profit_rate,毛利率(%)
    net_profits,净利润(万元)
    eps,每股收益
    business_income,营业收入(百万元)
    bips,每股主营业务收入(元)

调用方法：

::

    #获取2014年第3季度的盈利能力数据
    fd.get_profit_data(2014,3)

结果返回：

::

          code    name      roe     net_profit_ratio gross_profit_rate net_profits  \
    0     000520  *ST凤凰    9404.26     569.35         12.3743        4360.5897   
    1     600550  *ST天威    182.73      9.73           21.5026        292.5635   
    2     600816   安信信托   51.47       60.79          81.0632        820.8976   
    3     600381  *ST贤成    48.61       2159.06        -0.935         154.6058   
    4     000420   吉林化纤  46.24        11.85          6.0526         95.4614   
    5     600385   ST金泰    37.74        0.89          2.8962         10.775   
    6     000034   深信泰丰   34.43       14.54         11.5839         54.717   
    7     002174   游族网络   34.14       44.07          66.4404        254.5113   
    8     600382   广东明珠   33.38       960.9          64.1516         827.558   
    9     600766   园城黄金   32.77       64.56          86.1971        13.0563   
    10    000017   深中华A    32.55       2.09           7.1572         3.3881   

营运能力
--------

按年度、季度获取营运能力数据，结果返回的数据属性说明如下：

::

    code,代码
    name,名称
    arturnover,应收账款周转率(次)
    arturndays,应收账款周转天数(天)
    inventory_turnover,存货周转率(次)
    inventory_days,存货周转天数(天)
    currentasset_turnover,流动资产周转率(次)
    currentasset_days,流动资产周转天数(天)

调用方法：

::

    #获取2014年第3季度的营运能力数据
    fd.get_operation_data(2014,3)

结果返回：

::

          code     name   arturnover arturndays  inventory_turnover  inventory_days  \
    0     600605   汇通能源     5.7747    62.3409        102298.4414         0.0035   
    1     002649   博彦科技          3        120         37127.2743         0.0097   
    2     002707   众信旅游    20.0313    17.9719           7704.973         0.0467   
    3     002039   黔源电力     7.8636    45.7806          6360.2514         0.0566   
    4     300071   华谊嘉信      1.809    199.005          3002.9073         0.1199   
    5     002357   富临运业    53.2925     6.7552          2947.0547         0.1222   
    6     002400   省广股份     4.7772     75.358           2592.977         0.1388   
    7     000415   渤海租赁     8.1159    44.3574          1608.9875         0.2237   
    8     600897   厦门空港       5.11    70.4501          1093.2727         0.3293   
    9     002238   天威视讯    15.5591    23.1376           903.7139         0.3984   
    10    600270   外运发展     3.8491    93.5284           755.0421         0.4768   

成长能力
--------

按年度、季度获取成长能力数据，结果返回的数据属性说明如下：

::

    code,代码
    name,名称
    mbrg,主营业务收入增长率(%)
    nprg,净利润增长率(%)
    nav,净资产增长率
    targ,总资产增长率
    epsg,每股收益增长率
    seg,股东权益增长率

调用方法：

::

    #获取2014年第3季度的成长能力数据
    fd.get_growth_data(2014,3)

结果返回：

::

          code   name       mbrg        nprg         nav       targ        epsg  \
    0     600566   洪城股份  1479.2517  84495.0729    338.3363   200.8906  16133.3333   
    1     600105   永鼎股份    39.5802  24575.3671      8.6028   -34.6496    437.0968   
    2     600598  *ST大荒   -40.8583   7030.3488     10.3021   -38.2057      1112.5   
    3     600483   福能股份   354.7807   6718.1981    671.6278  1085.3524   2234.0807   
    4     000678   襄阳轴承    67.0414   6565.1816      5.0957    22.7679        3400   
    5     600822   上海物贸   -27.9066   6005.3197      1.5399   -16.5748   -102.3377   
    6     300134   大富科技    52.2005   5397.1468      15.932    26.7249        6200   
    7     600730   中国高科   137.1223   4068.2816     67.4825    15.0042   3697.0803   
    8     000985   大庆华科    35.0846   3106.1411      7.3651     7.2652        2920   
    9     300208   恒顺电气   263.2526   2510.8422     12.2521     3.4033   1421.9048   
    10    603077   和邦股份    34.8709   1548.3749     46.0789    60.1127    674.1935   

偿债能力
--------

按年度、季度获取偿债能力数据，结果返回的数据属性说明如下：

::

    code,代码
    name,名称
    currentratio,流动比率
    quickratio,速动比率
    cashratio,现金比率
    icratio,利息支付倍数
    sheqratio,股东权益比率
    adratio,股东权益增长率

调用方法：

::

    #获取2014年第3季度的偿债能力数据
    fd.get_debtpaying_data(2014,3)

结果返回：

::

          code     name     currentratio quickratio    cashratio      icratio  \
    0     002739   万达院线            0          0            0            0   
    1     000892   星美联合    3529.4671  3529.4671  352946.7104     5392.979   
    2     300223   北京君正     132.0156   123.7622    11339.085     105.3182   
    3     002348   高乐股份      46.9939    40.4353     1960.449    -543.8806   
    4     300333   兆日科技      41.7573    39.2037    3817.8843      -240.84   
    5     300042   朗科科技      28.8297    27.1808    2508.1954    -115.0911   
    6     300085    银之杰      31.2141    30.1414    1819.2099      63.2537   
    7     002279   久其软件      20.0396    19.9498     876.2346    -317.0054   
    8     002148   北纬通信      23.0136    22.9742    1083.1275    -294.4272   
    9     002322   理工监测      28.9634    27.0216    1693.6619    -112.0428   
    10    300288   朗玛信息      34.7063    34.7063    2475.7024    -269.7696   

现金流量
--------

按年度、季度获取现金流量数据，结果返回的数据属性说明如下：

::

    code,代码
    name,名称
    cf_sales,经营现金净流量对销售收入比率
    rateofreturn,资产的经营现金流量回报率
    cf_nm,经营现金净流量与净利润的比率
    cf_liabilities,经营现金净流量对负债比率
    cashflowratio,现金流量比率

调用方法：

::

    #获取2014年第3季度的现金流量数据
    fd.get_cashflow_data(2014,3)

结果返回：

::

          code    name    cf_sales   rateofreturn  cf_nm     cf_liabilities  \
    0     600291  西水股份   236.89       0.4004   25.4636         0.5169   
    1     600485  信威集团  11.7365       0.1141  474.5382         0.5092   
    2     600683  京投银泰  10.4481       0.0816         0         0.0879   
    3     000712  锦龙股份   9.8521       0.0338    1.1299         0.0495   
    4     600715  松辽汽车   8.7834       0.0647         0         0.0635   
    5     300059  东方财富   5.7247       0.4412   30.3246         0.7406   
    6     000668  荣丰控股     4.52       0.0221         0         0.0392   
    7     600773  西藏城投   2.6402       0.1763   56.2188         0.2015   
    8     000068  华控赛格   2.2098       0.1357         0         0.1874   
    9     600215  长春经开   1.9857       0.1104         0         0.2359   
    10    300156  神雾环保   1.6736       0.0509   13.1981         0.1571

	
